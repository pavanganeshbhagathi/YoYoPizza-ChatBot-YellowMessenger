# pavan ganesh bhagathi-YoYoPizza-ChatBot-YellowMessenger

<h4>PROBLEM STATEMENT</h4>

Build a pizza ordering bot for YoYo Pizza! 
We want you to build a chatbot using any platform/API which can help users with the Pizza Ordering. 
Imagine what the user flow would look like in an actual store; 
All the orders generated on the Bot should get stored in a database (The choice of DB is left to you). 
URL Shortener is an application which will convert long URLs to short URLs. 
There are popular services like bit.ly which does this job. 

Application requirements: 
The bot should support the following use-cases: 
1. Order a pizza 
2. Take user details 
3. Check Pizza Status by Order ID 
4. UI to chat with the chatbot App should be deployed on a server, and should be accessible. 

Please give instructions to use the app. 
Add-on features: 

● NLP 

● Context processing 

Things to be submitted: 
1. Link for the app 
2. Code Repository link 
3. Application Architecture 
4. Product Documentation- Steps to use the app - optional 
5. Developer Documentation(APIs/Modules) - optional

============================================================================

<h1>YoYoPizza</h1>

<h2>About the YoYoPizza ChatBot</h2>
Pizza Ordering ChatBot using Dialogflow and Firebase. Using YoYoPizza ChatBot we can order the pizza.

<h2>Link for the YoYoPizza ChatBot</h2>
https://bot.dialogflow.com/bca4bf91-e57d-4af7-be6d-f0739d77c01d

<H1>ARCHITECTURE</H1>
<img src="https://github.com/pavanganeshbhagathi/YoYoPizza-ChatBot-YellowMessenger/blob/master/Document%20Images/Entity/final/Architecture.png">

<h1>Steps to use YoYoPizza ChatBot</h1>

<h4>STEP 1: Start our bot saying Hi or Helloo..</h4>
<img src="https://github.com/pavanganeshbhagathi/YoYoPizza-ChatBot-YellowMessenger/blob/master/Document%20Images/Entity/chatboxflow/chat1.png" height=210 width=380>

<h4>STEP 2: You can choose the type your favourite Pizza (Veg or Non-Veg)</h4>

<img src="https://github.com/YashasreeTummala/YashasreeTummala-YoYoPizza-ChatBot-YellowMessenger/blob/master/Document%20Images/Entity/chatboxflow/chat2.jpg" height=340 width=380>

<h4>STEP 3: You can pick now based on your favourite Pizza (Paneer Pizza/ Chicken Pizza/ Corn Pizza/ BBQ Chicken Pizza..)</h4>
<img src="https://github.com/pavanganeshbhagathi/YoYoPizza-ChatBot-YellowMessenger/blob/master/Document%20Images/Entity/chatboxflow/chat3.png" height=340 width=380>

<h4>STEP 4: Choose the size based on your hunger (Small, Medium, Large, Extra Large..)</h4>
<img src="https://github.com/pavanganeshbhagathi/YoYoPizza-ChatBot-YellowMessenger/blob/master/Document%20Images/Entity/chatboxflow/chat4.png" height=340 width=380>

<h4>STEP 5: Choose your favourite Toppings (Cheese, Baby Corn, Pepperoni, Mushroom, Tomato... )</h4>
<img src="https://github.com/pavanganeshbhagathi/YoYoPizza-ChatBot-YellowMessenger/blob/master/Document%20Images/Entity/chatboxflow/chat5.png" height=340 width=380>

<h4>STEP 6: Type OK to place your order.</h4>
<img src="https://github.com/pavanganeshbhagathi/YoYoPizza-ChatBot-YellowMessenger/blob/master/Document%20Images/Entity/chatboxflow/chat6.png" height=340 width=380>

<h4>STEP 7: Enter your Contact details for further information (Name) </h4>
<img src="https://github.com/pavanganeshbhagathi/YoYoPizza-ChatBot-YellowMessenger/blob/master/Document%20Images/Entity/chatboxflow/chat7.png" height=340 width=380>

<h4>STEP 8: Enter your valid Contact details for further information (Mobile) </h4>
<img src="https://github.com/pavanganeshbhagathi/YoYoPizza-ChatBot-YellowMessenger/blob/master/Document%20Images/Entity/chatboxflow/chat8.png" height=340 width=380>

<h4>STEP 9: Enter Address details for delivery & also make a note of your Order Number displayed to check the Order Status.</h4>
<img src="https://github.com/pavanganeshbhagathi/YoYoPizza-ChatBot-YellowMessenger/blob/master/Document%20Images/Entity/chatboxflow/chat9.png" height=340 width=380>

<h4>STEP 10: Type "Status or Order Status" to track your order. </h4>
<img src="https://github.com/pavanganeshbhagathi/YoYoPizza-ChatBot-YellowMessenger/blob/master/Document%20Images/Entity/chatboxflow/chat10.png" height=340 width=380>

<h4>STEP 11: Enter the correct Order Number to check the status (if entered wrong, try again).</h4>
<img src="https://github.com/pavanganeshbhagathi/YoYoPizza-ChatBot-YellowMessenger/blob/master/Document%20Images/Entity/chatboxflow/chat11fails.png" height=340 width=380>

<h4>STEP 12: Enter the correct Order Number to check the status.</h4>
<img src="https://github.com/pavanganeshbhagathi/YoYoPizza-ChatBot-YellowMessenger/blob/master/Document%20Images/Entity/chatboxflow/chat12.png" height=340 width=380>


============================================================================

<H1>FIREBASE REALTIME DATABASE</H1>
<h2>
The Firebase Realtime Database is a cloud-hosted database. 
All the orders of YoYo Pizza are sent to Firebase.
Data is stored as JSON and synchronized in realtime to every connected client. 
</h2>
<img src="https://github.com/pavanganeshbhagathi/YoYoPizza-ChatBot-YellowMessenger/blob/master/Document%20Images/Entity/final/firebase.png">



============================================================================

<H1>Development</H1>
<h2>
How to train boat and developement 
</h2>

<h4>Entities</h4>
<img src="https://github.com/pavanganeshbhagathi/YoYoPizza-ChatBot-YellowMessenger/blob/master/Document%20Images/Entity/final/ENTITIES.png">
<h4>Description</h4>
<h5>step 1 :</h5>
<h5>step 2 :</h5>
<h5>step 3 :</h5>
<h5>step 4 :</h5>



<h4>yoyo welcome</h4>
<img src="https://github.com/pavanganeshbhagathi/YoYoPizza-ChatBot-YellowMessenger/blob/master/Document%20Images/Entity/final/yoyowelcome.png">
<h4>Description</h4>
<h5>step 1 :</h5>
<h5>step 2 :</h5>
<h5>step 3 :</h5>


<h4>yoyo start</h4>
<img src="https://github.com/pavanganeshbhagathi/YoYoPizza-ChatBot-YellowMessenger/blob/master/Document%20Images/Entity/final/yoyostart.png">
<h4>Description</h4>
<h5>step 1 :</h5>
<h5>step 2 :</h5>
<h5>step 3 :</h5>
<h5>step 4 :</h5>





<h4>yoyo pizzaname</h4>
<img src="https://github.com/pavanganeshbhagathi/YoYoPizza-ChatBot-YellowMessenger/blob/master/Document%20Images/Entity/final/yoyopizzaname.png">
<h4>Description</h4>
<h5>step 1 :</h5>
<h5>step 2 :</h5>
<h5>step 3 :</h5>
<h5>step 4 :</h5>


<h4>yoyo pizzasize</h4>
<img src="https://github.com/pavanganeshbhagathi/YoYoPizza-ChatBot-YellowMessenger/blob/master/Document%20Images/Entity/final/pizzasize.png">
<h4>Description</h4>
<h5>step 1 :</h5>
<h5>step 2 :</h5>
<h5>step 3 :</h5>
<h5>step 4 :</h5>



<h4>yoyo pizzatopping</h4>
<img src="https://github.com/pavanganeshbhagathi/YoYoPizza-ChatBot-YellowMessenger/blob/master/Document%20Images/Entity/final/yoyopizzatopping.png">
<h4>Description</h4>
<h5>step 1 :</h5>
<h5>step 2 :</h5>
<h5>step 3 :</h5>
<h5>step 4 :</h5>


<h4>yoyo customerdeatils</h4>
<img src="https://github.com/pavanganeshbhagathi/YoYoPizza-ChatBot-YellowMessenger/blob/master/Document%20Images/Entity/final/customerdeatils.png">
<h4>Description</h4>
<h5>step 1 :</h5>
<h5>step 2 :</h5>
<h5>step 3 :</h5>
<h5>step 4 :</h5>


<h4>Default Welcome</h4>

<img src="https://github.com/pavanganeshbhagathi/YoYoPizza-ChatBot-YellowMessenger/blob/master/Document%20Images/Entity/final/defaultwelocme.png">
<h4>Description</h4>
<h5>step 1 :</h5>
<h5>step 2 :</h5>
<h5>step 3 :</h5>
<h5>step 4 :</h5>




<h4>Default fallback</h4>
<img src="https://github.com/pavanganeshbhagathi/YoYoPizza-ChatBot-YellowMessenger/blob/master/Document%20Images/Entity/defaultfallback/defaultfallback.png">
<h4>Description</h4>
<h5>step 1 :</h5>
<h5>step 2 :</h5>


<h3>index.js</h3>
<p>
	
'use strict';
 
<p>const functions = require('firebase-functions');</p>
<p>const admin = require('firebase-admin');</p>
<p>const {WebhookClient} = require('dialogflow-fulfillment');</p>
<p>const {Card, Suggestion} = require('dialogflow-fulfillment');</p>
<p>//yoyo-pizza-hbfk.firebaseio.com --> database url ! we can use "https" for accessing our DB but here we use "ws" </p>
<p>admin.initializeApp({</p>
<p>	credential: admin.credential.applicationDefault(),</p>
 <p> 	databaseURL: 'ws://yoyo-pizza-hbfk.firebaseio.com/'</p>
<p>});</p>
 
process.env.DEBUG = 'dialogflow:debug';  
exports.dialogflowFirebaseFulfillment = functions.https.onRequest((request, response) => {
  const agent = new WebhookClient({ request, response });
  console.log('Dialogflow Request headers: ' + JSON.stringify(request.headers));
  console.log('Dialogflow Request body: ' + JSON.stringify(request.body));
  //var db = admin.database();
  //var ref = db.ref("server/saving-data/fireblog");
  
  function welcomeMsg(agent) {
    agent.add(`Welcome to Yoyo Pizza!`);
  }
 
  //this method is called when the chatbot doesnt understand our response
  function defaultFallback(agent) {
    agent.add(`Sorry , I didn't understand ðŸ¤·ðŸ¼â€â™‚ï¸`);
    agent.add(`Something wrong with your query , can you please try again? ðŸ¤·ðŸ¼â€â™‚ï¸`);
  }
  
  //details gathered from chatbot will be updated into database
  function checkoutorder(agent){
    const yoyotype = agent.parameters.yoyotype;
    const yoyosize = agent.parameters.yoyosize;
    const yoyotoppings = agent.parameters.yoyotoppings;
    const yoyopizzaname = agent.parameters.yoyopizzaname;
    
    //generating a random 4 digit number that is used as order id
    const orderid = Math.floor((Math.random() * 9999) + 1000);
   
    const yoyocustomername = agent.parameters.name;
    const yoyocustomerphone = agent.parameters.phoneno;
    const yoyocustomeraddress = agent.parameters.address;
       
    agent.add(`${yoyocustomername} Here's Your order id ${orderid}. Inorder to check your order ðŸšš please enter "Order Status"`);  
    //updating data into database
    return admin.database().ref('data').set({
      //the left fields must match database fields !
      yoyo_type: yoyotype,
      yoyo_size: yoyosize,
      yoyo_toppings: yoyotoppings,
      yoyo_pizzaname:yoyopizzaname,
      orderid: orderid,
      name: yoyocustomername,
      mobilenumber : yoyocustomerphone,
      address: yoyocustomeraddress
    });
    
  }
  //using order id we will track the order details from DB in this method !
  function trackorderbyid(agent){
    //getting order id from chatbot input i.e., input from user
    const orderid = agent.parameters.orderid;
    return admin.database().ref('data').once('value').then((snapshot)=>{
      //getting required or necessary details from database
    const dbOrderid = snapshot.child('orderid').val();
    const pizza_name = snapshot.child('yoyo_pizzaname').val();
    const pizza_type = snapshot.child('yoyo_type').val();
    const customer_name = snapshot.child('name').val();
      //checking if the order id obtained from user exists in the database , if yes we will print the details else we will print a msg to try again
      if(dbOrderid==orderid){
       agent.add(`Here's your Order Details , Your ${pizza_type} ${pizza_name} Pizza is almost ready!! Thank you ${customer_name} for ordering with yoyo pizza! ðŸš›ðŸ•`);
      }
      else 
        agent.add(`please check your order id and try again :) !`);
        
    });
  }
  //mapping fulfillment with intents
  let intent = new Map();
  intent.set('Default Fallback Intent', defaultFallback);
  intent.set('yoyo-customerdetails', checkoutorder);
  intent.set('yoyo-orderstatus', trackorderbyid);
  agent.handleRequest(intent);
});



</p>

<h3>package.json</h3>
{
  "name": "dialogflowFirebaseFulfillment",
  "description": "This is the default fulfillment for a Dialogflow agents using Cloud Functions for Firebase",
  "version": "0.0.1",
  "private": true,
  "license": "Apache Version 2.0",
  "author": "Google Inc.",
  "engines": {
    "node": "10"
  },
  "scripts": {
    "start": "firebase serve --only functions:dialogflowFirebaseFulfillment",
    "deploy": "firebase deploy --only functions:dialogflowFirebaseFulfillment"
  },
  "dependencies": {
    "actions-on-google": "^2.2.0",
    "firebase-admin": "^5.13.1",
    "firebase-functions": "^2.0.2",
    "dialogflow": "^0.6.0",
    "dialogflow-fulfillment": "^0.5.0"
  }
}










